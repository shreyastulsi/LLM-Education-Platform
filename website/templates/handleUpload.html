{% extends "base.html" %}
{% block title %}Upload Source{% endblock %}
{% block content %}
<section class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <p class="text-sm text-slate-500">PDF or YouTube link</p>
      <h1 class="text-3xl font-bold text-midnight">Upload your study source</h1>
    </div>
  </div>

  <div class="grid lg:grid-cols-2 gap-6">
    <div class="rounded-2xl border border-slate-100 bg-white/90 p-6 shadow-sm">
      <h2 class="text-lg font-semibold text-midnight mb-2">PDF upload</h2>
      <p class="text-sm text-slate-600 mb-4">Upload a PDF to build a knowledge base for generation, chat, and testing.</p>
      <form action="/handleUpload" method="post" enctype="multipart/form-data" class="space-y-3">
        <label class="block text-sm font-semibold text-slate-700">Choose a PDF</label>
        <input type="file" name="pdf_file" id="pdf_file" accept="application/pdf" onchange="previewPDF(this)" class="w-full rounded-xl border border-dashed border-slate-300 bg-slate-50 px-3 py-3 text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-400">
        <button type="submit" class="w-full rounded-xl bg-sky-500 text-white font-semibold py-2.5 shadow-lg shadow-sky-200 hover:bg-sky-600 transition">Upload PDF</button>
      </form>
    </div>

    <div class="rounded-2xl border border-slate-100 bg-white/90 p-6 shadow-sm">
      <h2 class="text-lg font-semibold text-midnight mb-2">YouTube lecture</h2>
      <p class="text-sm text-slate-600 mb-4">Paste a YouTube URL. We'll pull the transcript to build the knowledge base.</p>
      <form action="/handleUpload" method="post" enctype="multipart/form-data" class="space-y-3">
        <label class="block text-sm font-semibold text-slate-700">YouTube link</label>
        <input type="text" id="youtubeLink" name="youtube_link" oninput="showVideo()" placeholder="https://www.youtube.com/watch?v=..." class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-400">
        <button type="submit" class="w-full rounded-xl bg-mint-500 text-white font-semibold py-2.5 shadow-lg shadow-sky-200 hover:bg-emerald-500 transition">Save YouTube link</button>
      </form>
    </div>
  </div>

  <div class="rounded-2xl border border-slate-100 bg-white/90 p-4 shadow-sm">
    <h3 class="text-sm font-semibold text-slate-700 mb-2">Preview</h3>
    <div class="aspect-video rounded-xl border border-dashed border-slate-200 bg-slate-50 overflow-hidden">
      <iframe id="pdf_frame" class="w-full h-full" allowfullscreen></iframe>
    </div>
  </div>
</section>

<script>
  function previewPDF(input) {
    const file = input.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (event) {
        const frame = document.getElementById('pdf_frame');
        frame.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
  }
  function showVideo() {
    const url = document.getElementById('youtubeLink').value;
    if (!url.includes('youtube.com/watch')) return;
    let videoId = url.split('v=')[1] || '';
    const ampersandPosition = videoId.indexOf('&');
    if (ampersandPosition !== -1) {
      videoId = videoId.substring(0, ampersandPosition);
    }
    const embedUrl = "https://www.youtube.com/embed/" + videoId;
    document.getElementById('pdf_frame').src = embedUrl;
  }
</script>
{% endblock %}
